<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise de Dados Jur√≠dicos - Empr√©stimos Consignados</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #24292f;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #ffffff;
        }
        
        h1, h2, h3 {
            border-bottom: 1px solid #d1d9e0;
            padding-bottom: 10px;
        }
        
        h1 {
            font-size: 2em;
            margin-bottom: 20px;
        }
        
        h2 {
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        
        h3 {
            font-size: 1.25em;
            margin-top: 25px;
            margin-bottom: 10px;
        }
        
        .code-block {
            background-color: #f6f8fa;
            border: 1px solid #d1d9e0;
            border-radius: 6px;
            padding: 16px;
            margin: 16px 0;
            overflow-x: auto;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 12px;
            line-height: 1.45;
        }
        
        .output {
            background-color: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 12px 16px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .cat-gif {
            text-align: center;
            margin: 30px 0;
        }
        
        .cat-gif img {
            max-width: 300px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .stats-box {
            background-color: #f1f8ff;
            border: 1px solid #c8e1ff;
            border-radius: 6px;
            padding: 16px;
            margin: 16px 0;
        }
        
        .warning {
            background-color: #fff8dc;
            border: 1px solid #f5c842;
            border-radius: 6px;
            padding: 12px;
            margin: 10px 0;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 16px 0;
        }
        
        th, td {
            border: 1px solid #d1d9e0;
            padding: 8px 12px;
            text-align: left;
        }
        
        th {
            background-color: #f6f8fa;
            font-weight: 600;
        }
        
        .emoji {
            font-size: 1.2em;
        }
    </style>
</head>
<body>

<h1>üìä An√°lise de Dados Jur√≠dicos - Empr√©stimos Consignados</h1>

<div class="cat-gif">
    <img src="https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif" alt="Cat coding">
</div>

## 1. üì• IMPORTA√á√ÉO E COMPREENS√ÉO DOS DADOS

<div class="code-block">
pip install pandas
</div>

<div class="output">
Requirement already satisfied: pandas in c:\users\funar\appdata\local\packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\site-packages (2.3.1)
Requirement already satisfied: numpy>=1.23.2 in c:\users\funar\appdata\local\packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\site-packages (from pandas) (2.3.2)
Requirement already satisfied: python-dateutil>=2.8.2 in c:\users\funar\appdata\local\packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\site-packages (from pandas) (2.9.0.post0)
Requirement already satisfied: pytz>=2020.1 in c:\users\funar\appdata\local\packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\site-packages (from pandas) (2025.2)
Requirement already satisfied: tzdata>=2022.7 in c:\users\funar\appdata\local\packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\site-packages (from pandas) (2025.2)
Requirement already satisfied: six>=1.5 in c:\users\funar\appdata\local\packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\site-packages (from python-dateutil>=2.8.2->pandas) (1.17.0)
Note: you may need to restart the kernel to use updated packages.
</div>

<div class="code-block">
import pandas as pd
import re
import numpy as np
import re

try:
    teste = re.compile(r'test')
    print("‚úÖ re.compile() est√° funcionando!")
except Exception as e:
    print(f"‚ùå Erro: {e}")
</div>

<div class="output">‚úÖ re.compile() est√° funcionando!</div>

### 1.1 üìã Estrutura do dataset

Nosso dataset (**dataset_clinica20252.csv**) cont√©m **19.800** observa√ß√µes com as seguintes colunas:

<table>
<tr><th>Campo</th><th>Descri√ß√£o</th><th>Caracter√≠sticas</th></tr>
<tr><td>cd_causa</td><td>C√≥digo identificador do caso</td><td>10 caracteres, formato: CIB + n√∫meros</td></tr>
<tr><td>cd_atendimento</td><td>N√∫mero do processo</td><td>25 caracteres, formato: NNNNNN-XX.YYYY.Z.AA.BBBB</td></tr>
<tr><td>ds_Acao_Judicial</td><td>Tipo da a√ß√£o</td><td>Predominantemente "90 - ACAO DE REPARACAO DE DANOS"</td></tr>
<tr><td>ds_fatos</td><td>Descri√ß√£o dos fatos</td><td>Texto longo (at√© 5.000 caracteres)</td></tr>
<tr><td>ds_Pedidos</td><td>Pedidos do autor</td><td>Texto longo (at√© 5.000 caracteres)</td></tr>
<tr><td>ds_Qualificacao</td><td>Qualifica√ß√£o das partes</td><td>Dados das partes envolvidas</td></tr>
</table>

<div class="code-block">
# Importa√ß√£o do dataset
df = pd.read_csv('dataset_clinica20252.csv', delimiter='|', encoding='utf-8')
</div>

### üîç Verifica√ß√£o p√≥s importa√ß√£o

<div class="code-block">
# FUN√á√ÉO: len()
# O QUE FAZ: conta o n√∫mero de linhas (registros) no DataFrame
# SINTAXE: len(dataframe)
len(df)
</div>

<div class="output">19800</div>

<div class="code-block">
# FUN√á√ÉO: list()
# O QUE FAZ: converte o √≠ndice(nome da coluna) das colunas em uma lista que 
# podemos ler facilmente
# SINTAXE: list(df.columns)
list(df.columns)
</div>

<div class="output">['cd_causa',
 'cd_atendimento',
 'ds_Acao_Judicial',
 'ds_fatos',
 'ds_Pedidos',
 'ds_Qualificacao']</div>

### üìä N√∫mero de NAs

<div class="code-block">
# FUN√á√ÉO: df.dropna()
# O QUE FAZ: remove todas as linhas que t√™m pelo menos um valor vazio (NaN)
# SINTAXE: df.dropna()

# FUN√á√ÉO: .shape[0]
# O QUE FAZ: retorna o n√∫mero de linhas do DataFrame resultante
# SINTAXE: dataframe.shape[0]

df.dropna().shape[0]
</div>

<div class="output">19799</div>

<div class="cat-gif">
    <img src="https://media.giphy.com/media/VbnUQpnihPSIgIXuZv/giphy.gif" alt="Cat analyzing data">
</div>

## 2. üßπ NORMALIZA√á√ÉO E LIMPEZA DOS DADOS

<div class="code-block">
# FUN√á√ÉO: df.head()
# O QUE FAZ: mostra as primeiras 5 linhas do DataFrame
# SINTAXE: df.head(numero_de_linhas)
df.head(3)
</div>

<div class="code-block">
# FUN√á√ÉO: df['coluna'].str.contains()
# O QUE FAZ: busca por padr√µes espec√≠ficos dentro de uma coluna de texto
# SINTAXE: df['coluna'].str.contains('padr√£o')
problemas_encoding = df['ds_fatos'].str.contains('√É¬™|√É¬©|√É¬°|√É¬≥|√É¬≠|√É¬∫|√É¬ß|√É¬£|¬©', 
                                                 na=False)

problemas_encoding.sum()
</div>

<div class="output">9</div>

### üîç Verificar problemas com espa√ßamento

<div class="code-block">
problemas_espaco = df['ds_fatos'].str.contains('  +', 
                                                 na=False)
problemas_espaco.sum()
</div>

<div class="output">0</div>

<div class="code-block">
caracteres_corrompidos = df['ds_fatos'].str.contains('‚Äì', na=False)
caracteres_corrompidos.sum()
</div>

<div class="output">0</div>

### üßº Limpar espacamento duplo e s√≠mbolo ‚Äì

<div class="code-block">
# FUN√á√ÉO: df['coluna'].str.replace()
# O QUE FAZ: substitui caracteres espec√≠ficos por outros
# SINTAXE: df['coluna'].str.replace('caractere_antigo', 'caractere_novo')
# COMPLETAR: caracteres espec√≠ficos
df['ds_fatos'] = df['ds_fatos'].str.replace('‚Äì', '')
df['ds_Pedidos'] = df['ds_Pedidos'].str.replace('‚Äì', '')

# FUN√á√ÉO: df['coluna'].str.replace() com regex
# O QUE FAZ: substitui m√∫ltiplos espa√ßos por um √∫nico espa√ßo
# SINTAXE: df['coluna'].str.replace('padr√£o_regex', 'substituto', regex=True)
# COMPLETAR: espacamento duplo
# padrao_regex - string raw: r'\s+'
df['ds_fatos'] = df['ds_fatos'].str.replace(r'\s+', ' ', regex=True)
df['ds_Pedidos'] = df['ds_Pedidos'].str.replace(r'\s+', ' ', regex=True)
</div>

<div class="cat-gif">
    <img src="https://media.giphy.com/media/o0vwzuFwCGAFO/giphy.gif" alt="Cat cleaning">
</div>

## 3. üîç EXPRESS√ïES REGULARES APLICADAS

### üìù Ver valores √∫nicos como output direto

<div class="code-block">
# FUN√á√ÉO: df['coluna'].unique()
# O QUE FAZ: retorna array com todos os valores √∫nicos da coluna
# SINTAXE: df['coluna'].unique()
valores_unicos_fatos = df['ds_fatos'].unique()
</div>

<div class="code-block">
# FUN√á√ÉO: re.compile()
# O QUE FAZ: cria padr√£o que busca empr√©stimo E consignado no mesmo texto
# SINTAXE: re.compile(r'padr√£o')

# COMPLETAR:
padrao_emprestimo_consignado = re.compile(r'empr√©stimo\sconsignado|empr√©stimo\spor\sconsigna√ß√£o|' \
                                          r'empr√©stimos\sconsignados|contrato\sde\sconsigna√ß√£o')
</div>

<div class="warning">
<strong>‚ö†Ô∏è Importante:</strong> Como resolvemos o erro de TypeError com valores float/NaN?
</div>

<div class="code-block">
# FUN√á√ÉO: for loop com verifica√ß√£o de tipo
# O QUE FAZ: percorre cada linha verificando se √© texto antes de aplicar findall()
# SINTAXE: for texto in df['coluna'] com isinstance()
# A fun√ß√£o isinstance(texto, str) verifica se o valor √© string antes de aplicar o regex, 
# evitando o erro com valores float/NaN.

# COMPLETAR COM isinstance
resultados = []

for texto in df['ds_fatos']:
    if isinstance(texto, str): 
        matches = padrao_emprestimo_consignado.findall(texto)
        if len(matches) > 0:
            resultados.append(True)
        else:
            resultados.append(False)
    else:
       resultados.append(False)
</div>

<div class="code-block">
# FUN√á√ÉO: df['nova_coluna'] = lista
# O QUE FAZ: cria nova coluna no DataFrame com os valores da lista
# SINTAXE: df['nome_coluna'] = lista_valores
# FUN√á√ÉO: sum()
# O QUE FAZ: soma todos os valores True da coluna (conta quantos s√£o True)
# SINTAXE: sum(df['coluna_booleana'])

# COMPLETAR
df['eh_emprestimo_consignado'] = resultados
df['eh_emprestimo_consignado'].sum()
</div>

<div class="output">5937</div>

<div class="code-block">
# FUN√á√ÉO: df['coluna'].value_counts()
# O QUE FAZ: conta frequ√™ncia absoluta de cada valor √∫nico na coluna
# SINTAXE: df['coluna'].value_counts()

df['eh_emprestimo_consignado'].value_counts()
</div>

<div class="output">eh_emprestimo_consignado
False    13863
True      5937
Name: count, dtype: int64</div>

<div class="cat-gif">
    <img src="https://media.giphy.com/media/BzyTuYCmvSORqs1ABM/giphy.gif" alt="Cat with magnifying glass">
</div>

## 4. ‚úÖ VALIDA√á√ÉO DO MODELO

### 4.1. üìä Estat√≠sticas gerais do dataset

<div class="code-block">
# FUN√á√ÉO: sum() e len()
# O QUE FAZ: calcula totais e percentuais
# SINTAXE: sum(coluna) / len(df)

total_processos = len(df)
processos_consignado = sum(df['eh_emprestimo_consignado'])
percentual = (processos_consignado / total_processos) * 100

print(f"=== ESTAT√çSTICAS GERAIS ===")
print(f"Total de processos: {total_processos}")
print(f"Processos de cr√©dito consignado: {processos_consignado}")
print(f"Percentual: {percentual:.1f}%")
</div>

<div class="stats-box">
<strong>=== ESTAT√çSTICAS GERAIS ===</strong><br>
Total de processos: 19800<br>
Processos de cr√©dito consignado: 5937<br>
Percentual: 30.0%
</div>

### 4.2. üéØ VALIDA√á√ÉO POR PALAVRAS-CHAVE ESPEC√çFICAS

<div class="code-block">
# Casos que DEVEM ser pegos (teste de recall)
# Calcular percentual de textos √≥bvios capturados pelo regex

# FUN√á√ÉO: df[df['coluna'].str.contains()]
# O QUE FAZ: filtra textos que cont√™m 'empr√©stimo consignado' literalmente
# SINTAXE: df[df['coluna'].str.contains('termo', na=False)]

textos_obvios = df[df['ds_fatos'].str.contains('empr√©stimo consignado', na=False)]

# FUN√á√ÉO: sum()
# O QUE FAZ: conta quantos textos √≥bvios o regex identificou como True
# SINTAXE: sum(coluna_booleana)

capturados = sum(textos_obvios['eh_emprestimo_consignado'])

# Percentual de textos √≥bvios que foram capturados
percentual_capturados = (capturados / len(textos_obvios)) * 100

print(f"Total de textos √≥bvios: {len(textos_obvios)}")
print(f"Capturados pelo regex: {capturados}")
print(f"Percentual capturado: {percentual_capturados:.1f}%")
</div>

<div class="stats-box">
Total de textos √≥bvios: 4715<br>
Capturados pelo regex: 4715<br>
<strong>Percentual capturado: 100.0%</strong> ‚úÖ
</div>

<div class="cat-gif">
    <img src="https://media.giphy.com/media/ICOgUNjpvO0PC/giphy.gif" alt="Cat celebrating">
</div>

## 5. üèõÔ∏è UMA DICA: olhem para o n√∫mero do processo

### üìã AN√ÅLISE DO N√öMERO CNJ

**Extra√ß√£o de Tribunal e Ano do Processo usando RegExp**

#### üìã O que vamos aprender:
- Estrutura da numera√ß√£o √∫nica CNJ
- Como extrair o tribunal usando regex
- Como extrair o ano do processo
- Aplica√ß√£o pr√°tica no dataset

#### üîç Estrutura da Numera√ß√£o CNJ

A numera√ß√£o √∫nica CNJ segue o padr√£o: **NNNNNNN-DD.AAAA.J.TR.OOOO**

<table>
<tr><th>Campo</th><th>Descri√ß√£o</th><th>Exemplo</th></tr>
<tr><td>NNNNNNN</td><td>N√∫mero sequencial do processo</td><td>0825789</td></tr>
<tr><td>DD</td><td>D√≠gitos verificadores</td><td>84</td></tr>
<tr><td>AAAA</td><td>ANO do ajuizamento</td><td>2025</td></tr>
<tr><td>J</td><td>Segmento do Judici√°rio</td><td>8 (Justi√ßa Estadual)</td></tr>
<tr><td>TR</td><td>TRIBUNAL</td><td>18 (TJES - Esp√≠rito Santo)</td></tr>
<tr><td>OOOO</td><td>Unidade de origem</td><td>0140</td></tr>
</table>

#### üìç C√≥digos dos Segmentos (J):
- 1: STF
- 2: CNJ  
- 3: STJ
- 4: Justi√ßa Federal
- 5: Justi√ßa do Trabalho
- 6: Justi√ßa Eleitoral
- 7: Justi√ßa Militar da Uni√£o
- **8: Justi√ßa Estadual** ‚≠ê
- 9: Justi√ßa Militar Estadual

### üìÖ Extraindo anos

<div class="code-block">
# Criar padr√£o regex para capturar o ano
padrao_ano = re.compile('\d{7}-\d{2}\.(\d{4})\.\d.\d{2}\.\d{4}')

# Criar uma lista para armazenar resultados
anos = []

# Loop pelos n√∫meros de processo
for numero in df['cd_atendimento']:
    if isinstance(numero, str):
        # usar findall para capturar o ano
        matches = padrao_ano.findall(numero)
        if len(matches) > 0:
            ano = int(matches[0]) # pega o primeiro e √∫nico match
            anos.append(ano)
    else:
        anos.append(None)

df['ano'] = anos
df.head(7)
</div>

#### üéØ ESTRUTURA DO N√öMERO CNJ:

<div class="code-block">
# Exemplo visual da estrutura do n√∫mero CNJ
numero = "0825789-84.2025.8.18.0140"

print("üéØ ESTRUTURA DO N√öMERO CNJ:")
print()
print("N√∫mero CNJ:", numero)
print("           ", "^" * 7, "^" * 2, "^" * 4, "^", "^" * 2, "^" * 4)
print("           ", "|" * 7, "|" * 2, "|" * 4, "|", "|" * 2, "|" * 4)
print("           ", "Seq.   ", "DV", " ANO ", "J", "TR", "Origem")
print()
print("üìÖ Queremos capturar apenas o ANO: 2025")
print("üèõÔ∏è E tamb√©m o c√≥digo do Tribunal: 18")
</div>

<div class="output">üéØ ESTRUTURA DO N√öMERO CNJ:

N√∫mero CNJ: 0825789-84.2025.8.18.0140
            ^^^^^^^ ^^ ^^^^ ^ ^^ ^^^^
            ||||||| || |||| | || ||||
            Seq.    DV  ANO  J TR Origem

üìÖ Queremos capturar apenas o ANO: 2025
üèõÔ∏è E tamb√©m o c√≥digo do Tribunal: 18</div>

**Os par√™nteses dizem: "Encontre isso, mas me d√™ apenas esta parte!"**

<h3>üèõÔ∏è Vers√£o para Tribunal</h3>

<div class="code-block">
padrao_tribunal = re.compile(r'\d{7}-\d{2}\.\d{4}\.\d\.(\d{2})\.\d{4}')

# Dicion√°rio dos tribunais
TRIBUNAIS = {
    '01': 'TJAC', '02': 'TJAL', '03': 'TJAP', '04': 'TJAM', '05': 'TJBA',
    '06': 'TJCE', '07': 'TJDF', '08': 'TJES', '09': 'TJGO', '10': 'TJMA',
    '11': 'TJMT', '12': 'TJMS', '13': 'TJMG', '14': 'TJPA', '15': 'TJPB',
    '16': 'TJPR', '17': 'TJPE', '18': 'TJPI', '19': 'TJRJ', '20': 'TJRN',
    '21': 'TJRS', '22': 'TJRO', '23': 'TJRR', '24': 'TJSC', '25': 'TJSE',
    '26': 'TJSP', '27': 'TJTO'
}

# Lista para armazenar resultados:
tribunais = []

for numero in df['cd_atendimento']:
    if isinstance(numero, str):
        matches = padrao_tribunal.findall(numero)
        if len(matches) > 0:
            codigo = matches[0] # S√≥ pega o c√≥digo
            tribunal = TRIBUNAIS.get(codigo, f'Tribunal {codigo}')
            tribunais.append(tribunal)
        else:
            tribunais.append(None)
    else:
        tribunais.append(None)

df['tribunal'] = tribunais
df['tribunal'].value_counts()
</div>

<div class="output">tribunal
TJAM    5065
TJPI    3095
TJMA    1967
TJSP    1868
TJBA    1075
TJCE     932
TJPB     861
TJMG     701</div>

<div class="cat-gif">
    <img src="https://media.giphy.com/media/mlvseq9yvZhba/giphy.gif" alt="Cat with graduation cap">
</div>

---

<div style="text-align: center; margin-top: 50px; padding: 20px; background-color: #f6f8fa; border-radius: 8px;">
<h3>üéâ An√°lise Conclu√≠da!</h3>
<p>Dataset com <strong>19.800</strong> processos analisado com sucesso!</p>
<p>Identificados <strong>5.937</strong> casos de empr√©stimo consignado (<strong>30%</strong> do total)</p>
<p>Precis√£o de <strong>100%</strong> em casos √≥bvios</p>
</div>

</body>
</html>
